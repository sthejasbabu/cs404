var b = require('bonescript');
var pos = {};

var port = '/dev/i2c-2'
var matrix = 0x70;

/*var zero =
	[ 0x00 , 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00,
	  0x00 , 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00];
*/
var zero =
	[ 0x00 , 0x00, 0x44, 0x00, 0x48, 0x00, 0x50, 0x00,
	  0x60 , 0x00, 0x50, 0x00, 0x48, 0x00, 0x44, 0x00];


var one =
	[ 0x00 , 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00,
	  0x00 , 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00];

var two =
	[ 0x00 , 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00,
	  0x00 , 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00];

var three =
	[ 0x00 , 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00,
	  0x00 , 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00];
	  
var four =
	[ 0x00 , 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00,
	  0x00 , 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00];
	  
var five =
	[ 0x00 , 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00,
	  0x00 , 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00];
	  
var six =
	[ 0x00 , 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x00,
	  0x00 , 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00];
	  
/*var seven =
	[ 0x00 , 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00,
	  0x00 , 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00];
*/	  
var seven =
	[ 0x00 , 0x00, 0x45, 0x00, 0x45, 0x00, 0x45, 0x00,
	  0x7C , 0x00, 0x45, 0x00, 0x44, 0x00, 0x44, 0x00];

	  
b.i2cOpen(port, matrix);

b.i2cWriteByte(port,  0x21); // Start oscillator (p10)
b.i2cWriteByte(port,  0x81); // Disp on, blink off (p11)
b.i2cWriteByte(port,  0xe7); // Full brightness (page 15)


function onX(x) {
    pos.x = parseFloat(x.value * 100).toFixed(2);
    b.analogRead('P9_38', onY);
}

function onY(x) {
    pos.y = parseFloat(x.value * 100).toFixed(2);
	//console.log(JSON.stringify(pos));
	movLed();
}

function movLed(){
    var x = Math.floor(pos.x/12.5);
    var y = Math.floor(pos.y/12.5);
    console.log('x:'+ x+ ' y:'+ y);
    if(x==0) b.i2cWriteBytes(port, 0x00, zero);
    else if(x==1) b.i2cWriteBytes(port, 0x00, one);
    else if(x==2) b.i2cWriteBytes(port, 0x00, two);
    else if(x==3) b.i2cWriteBytes(port, 0x00, three);
    else if(x==4) b.i2cWriteBytes(port, 0x00, four);
    else if(x==5) b.i2cWriteBytes(port, 0x00, five);
    else if(x==6) b.i2cWriteBytes(port, 0x00, six);
    else b.i2cWriteBytes(port, 0x00, seven);
}

function read(){
    b.analogRead('P9_36', onX);
    setTimeout(read,10);
}

setTimeout(read,10);
